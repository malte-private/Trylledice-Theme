<link rel="stylesheet" href="https://unpkg.com/flickity@2/dist/flickity.min.css">
<script src="https://unpkg.com/flickity@2/dist/flickity.pkgd.min.js"></script>

{%- capture flickity_options -%}
  {
  "prevNextButtons": true,
                                              "pageDots": false,
                                              "contain": true,
                                              "cellAlign": "left",
                                              "groupCells": true,
                                              "arrowShape": {"x0": 20, "x1": 60, "y1": 40, "x2": 60, "y2": 35, "x3": 25}
                                              }{%- endcapture -%}

<div class="mx-auto my-0 featured-collection-slider max-w-7xl md:px-14 page-width">
  {% if section.settings.title != blank %}
    <div class="grid grid-cols-3 pb-4 justify-items-center">
      <h2 class="col-start-1 col-span-full place-self-center h3 heading-text-color">{{ section.settings.title | escape }}</h2>

      {% for block in section.blocks %}
        {% if block.settings.button_link %}
          {%- render 'button' block: block -%}
        {% endif %}
      {% endfor %}

    </div>
  {% endif %}

  {%- assign collection = collections[section.settings.collection] -%}
  {%- assign product_limit = section.settings.product_count -%}


  <ul class="px-10 products-carousel js-flickity" data-flickity='{{ flickity_options }}'>
    {% if collection != blank %}

      {% for product in collection.products limit: product_limit %}
        {% assign c = product %}
        {%include "collection-product" with c%}
      {% endfor %}
    {% else %}
      {% for product in collections["set"].products limit: 4 %}

        {% assign c = product  %}
        {%include "collection-product" with c%}
      {% endfor %}

    {% endif %}
  </ul>
</div>

<style>

  .flickity-button:disabled {
    pointer-events: all !important;
  }

}
</style>

{% schema %}
  {
    "name": "Collection Slider",
    "max_blocks": 1,
    "settings": [
      {
        "type": "text",
        "id": "title",
        "label": "Heading",
        "default": "Featured Collection"
      }, {
        "type": "collection",
        "id": "collection",
        "label": "Collection"
      }, {
        "type": "range",
        "id": "product_count",
        "min": 4,
        "max": 12,
        "label": "Number of products to display",
        "default": 4
      }
    ],
    "blocks": [
      {
        "name": "Button",
        "type": "buttons",
        "settings": [
          {
            "type": "header",
            "content": "Link"
          },
          {
            "type": "paragraph",
            "content": "Choose to show a link and set the label and URL"
          },
          {
            "type": "checkbox",
            "id": "button_link",
            "label": "Link",
            "default": true
          },
          {
            "type": "url",
            "id": "url",
            "label": "Button link"
          }, {
            "type": "text",
            "label": "Label for button",
            "id": "button_label",
            "default": "See all"
          }, {
            "type": "select",
            "id": "button_variant",
            "label": "Button variant",
            "options": [
              {
                "value": "primary",
                "label": "Primary"
              }, {
                "value": "primary-light",
                "label": "Primary Light"
              }, {
                "value": "secondary",
                "label": "Secondary"
              }, {
                "value": "minimal",
                "label": "Minimal"
              }
            ],
            "default": "minimal"
          }, {

            "type": "range",
            "id": "button_width",
            "min": 10,
            "max": 20,
            "step": 1,
            "label": "Width",
            "default": 12
          }, {

            "type": "range",
            "id": "button_margin",
            "min": 0,
            "max": 40,
            "step": 4,
            "unit": "px",
            "label": "Margin",
            "default": 4
          }

        ]

      }

    ],
    "presets": [
      {
        "category": "Collection",
        "name": "Collection Slider",
        "settings": {}
      }
    ]
  }
{% endschema %}